---
title: RAMMap 使用解析
description: RAMMap 使用解析

date: 20250128
plainLanguage: |
  **RAMMap 说白了就是：** Windows 内存的"透视镜"——能看清内存都被谁占了、占了多少、干啥用的。

  就像你的钱包，任务管理器只能告诉你"还剩 100 块"，RAMMap 能告诉你"50 块在零钱包、30 块在卡包、20 块在夹层，还有 10 块被压在卡片下面"。

  **用大白话说：**
  想象你的冰箱（内存），任务管理器只告诉你"还能放 3 层"，RAMMap 能告诉你"第1层放蔬菜、第2层放肉、第3层放饮料、冷冻室放速冻食品"，而且还能看到"哪些食材快过期了（缓存）"。

  **核心功能（Use Counts）：**

  **1. Process Private（进程私有）**：
  - 各个程序独占的内存（Chrome 占了 2GB，Steam 占了 1GB...）

  **2. Mapped File（内存映射文件）**：
  - 把文件"映射"到内存里，多个程序可以共享（比如系统 DLL）

  **3. Shareable（可共享）**：
  - 多个程序可以共享的内存（比如共享 DLL、COM 对象）

  **4. Page Table（页表）**：
  - 管理"虚拟地址→物理地址"映射的内存（系统管理开销）

  **5. Paged Pool（分页池）**：
  - 系统内核用的，可以被"换出"到硬盘的内存

  **6. Nonpaged Pool（非分页池）**：
  - 系统内核用的，**必须一直在内存里**的关键数据

  **为啥要用 RAMMap：**
  - **内存泄漏排查**：看哪个程序一直占着内存不放
  - **性能优化**：看内存都被谁占了，能不能释放一些
  - **缓存分析**：看文件缓存占了多少，是不是太多了

  说白了，RAMMap 就是"内存管家"——不仅告诉你还剩多少内存，还告诉你每一块内存都被谁占了、干啥用的，方便你"清理"和"优化"。
---






![](/assets/images/rammap-screenshot.png)




RAMMAP 是 Windows Vista 和更高版本的高级物理内存使用分析实用程序.  通过它可以轻松查看 Windows 如何分配物理内存, 在内存中缓存多少文件数据, 或内核和设备驱动程序使用了多少内存. 


## Use Counts 使用情况计数器

我们主要介绍 Use Counts 使用情况计数器, 它显示了每个特定的区域使用了多少内存. 


- Process Private: 进程私有内存, 指由特定进程独占使用的内存空间. 这些内存不能被其他进程访问或共享. 

- Mapped File: 内存映射文件, 由内核缓存管理器（Cache Manager）管理. 将文件内容直接映射到进程的地址空间中. 这通常用于提高文件访问效率, 多个进程可以共享同一个文件的映射（需使用相同映射方式和访问权限）. 

- Shareable: 可共享内存, 是可以被多个进程访问的内存区域. 这包括共享的DLL、COM对象等. 

- Page Table: 页表, 用于管理虚拟内存到物理内存的映射关系的系统数据结构. 它记录了虚拟地址到物理地址的转换信息. 

- Paged Pool: 分页池, 是系统核心组件使用的可被换出到磁盘的内存池. 主要用于存储系统数据结构、I/O请求等. 

- Nonpaged Pool: 非分页池, 是系统核心组件使用的不可被换出到磁盘的内存池. 用于存储必须常驻内存的关键系统数据. 

- System PTE: 系统页表项, 系统用于映射内核空间和系统数据的页表条目资源池. 

- Session Private: 会话私有内存, 与特定用户会话相关的私有内存空间. 主要用于存储用户界面相关的数据. 

- Metafile: 元文件内存, 用于存储系统元数据, 如NTFS文件系统的元数据等. 

- AWE (Address Windowing Extensions): 地址窗口扩展, 允许32位应用程序访问超过4GB的物理内存（在64位系统中已逐渐淘汰, 可以看到我这个机器的截图是0）. 

- Driver Locked: 驱动程序锁定的内存, 被设备驱动程序锁定而不能被换出的内存页面. 

- Kernel Stack: 内核栈, 用于系统内核执行函数调用和存储临时数据的内存空间. 

- Unused: 未使用的物理内存, 当前空闲可用的内存页面. 

- Large Page: 大页面内存, 使用较大的内存页面（通常是2MB或1GB）来减少页表开销, 提高性能. 

- Total: 所有类型内存使用的总和. 


## 如何使用 RAMMap 定位问题?

比如 Metafile 使用量很大, 说明系统正在访问大量的文件, 这可能出现在文件服务器上, 从而导致缓存的 NTFS metafile 数据无法从缓存中释放. 


## Refs

- [RAMMAP 下载地址](https://learn.microsoft.com/en-us/sysinternals/downloads/rammap)
